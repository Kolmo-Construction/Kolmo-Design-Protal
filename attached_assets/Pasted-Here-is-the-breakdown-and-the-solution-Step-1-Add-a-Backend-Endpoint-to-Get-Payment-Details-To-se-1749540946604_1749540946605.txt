Here is the breakdown and the solution:

Step 1: Add a Backend Endpoint to Get Payment Details
To securely display the payment amount on the public page, we'll first create a backend endpoint that provides non-sensitive payment information.

Please add the following route to server/routes/payment.routes.ts:

TypeScript

// server/routes/payment.routes.ts

// ... after existing imports and stripe initialization
import { HttpError } from '../errors'; //

const router = Router();

// ... existing routes

/**
 * NEW: Get public details of a payment intent
 */
router.get('/payment-intent/:paymentIntentId', async (req, res, next) => {
  try {
    if (!stripe) {
      throw new HttpError(503, 'Payment processing temporarily unavailable');
    }

    const { paymentIntentId } = req.params;
    const paymentIntent = await stripe.paymentIntents.retrieve(paymentIntentId);

    res.json({
      amount: paymentIntent.amount,
      currency: paymentIntent.currency,
      description: paymentIntent.description,
    });

  } catch (error) {
    next(error);
  }
});


// ... rest of the file
Step 2: Create the Public Payment Page
Next, you need a new page component that uses the route above to fetch payment details and render the PaymentForm. Create a new file, for example at client/src/pages/PublicPaymentPage.tsx:

TypeScript

// client/src/pages/PublicPaymentPage.tsx

import { useEffect, useState } from 'react';
import { useParams } from 'react-router-dom';
import { useQuery } from '@tanstack/react-query';
import { loadStripe } from '@stripe/stripe-js';
import { Elements } from '@stripe/react-stripe-js';
import { PaymentForm } from '@/components/payment/PaymentForm';
import { apiRequest } from '@/lib/queryClient';
import { Loader2, AlertTriangle } from 'lucide-react';

// Ensure your Stripe publishable key is in your .env file
const stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLISHABLE_KEY);

interface PaymentIntentDetails {
  amount: number;
  currency: string;
  description: string;
}

export default function PublicPaymentPage() {
  const { clientSecret } = useParams<{ clientSecret: string }>();
  const [paymentIntentId, setPaymentIntentId] = useState<string | null>(null);

  useEffect(() => {
    if (clientSecret) {
      const id = clientSecret.split('_secret_')[0];
      setPaymentIntentId(id);
    }
  }, [clientSecret]);

  const { data: paymentDetails, isLoading, error } = useQuery<PaymentIntentDetails>({
    queryKey: [`/api/payment-intent/${paymentIntentId}`],
    queryFn: () => apiRequest('GET', `/api/payment-intent/${paymentIntentId}`).then(res => res.json()),
    enabled: !!paymentIntentId,
  });

  if (isLoading || !paymentIntentId) {
    return (
      <div className="flex justify-center items-center min-h-screen">
        <Loader2 className="h-8 w-8 animate-spin" />
        <p className="ml-4">Loading Payment Details...</p>
      </div>
    );
  }

  if (error) {
    return (
      <div className="flex flex-col justify-center items-center min-h-screen">
        <AlertTriangle className="h-8 w-8 text-red-500 mb-4" />
        <h2 className="text-xl font-semibold mb-2">Error Loading Payment</h2>
        <p className="text-red-600">This payment link may be invalid or expired.</p>
      </div>
    );
  }

  if (!clientSecret || !paymentDetails) {
     return <div>Error: Invalid payment details.</div>;
  }

  return (
    <div className="flex justify-center items-center min-h-screen bg-gray-50">
        <Elements stripe={stripePromise} options={{ clientSecret }}>
            <PaymentForm
                clientSecret={clientSecret}
                amount={paymentDetails.amount / 100} // Stripe amount is in cents
                description={paymentDetails.description}
                onSuccess={() => {
                    window.location.href = '/payment-success'; // Redirect on success
                }}
            />
        </Elements>
    </div>
  );
}
Step 3: Add the New Route to Your Frontend Router
This is the critical step that fixes the 404 error. You must add a new route to your client-side router configuration. This file is not in the provided list, but it is typically named App.tsx, main.tsx, or routes.tsx.

Find where you define your <Routes> and add the new route for the payment page:

TypeScript

// In your main client-side router file (e.g., App.tsx)

import { BrowserRouter, Routes, Route } from 'react-router-dom';
import PublicPaymentPage from './pages/PublicPaymentPage'; // Adjust path if needed

// ... other imports and components

function App() {
  return (
    <BrowserRouter>
      <Routes>
        {/* ... your other routes (e.g., login, dashboard) ... */}
        
        {/* ADD THIS NEW ROUTE FOR PUBLIC PAYMENTS */}
        <Route path="/payment/:clientSecret" element={<PublicPaymentPage />} />

        {/* You should also have a success page */}
        <Route path="/payment-success" element={
          <div className="text-center p-10">
            <h1 className="text-2xl font-bold">Payment Successful!</h1>
            <p>Thank you for your payment. Your project manager has been notified.</p>
          </div>
        } />
        
        {/* ... your other routes ... */}
      </Routes>
    </BrowserRouter>
  );
}

export default App;
By implementing these three steps, you will create the necessary frontend infrastructure to handle the payment links, which will resolve the 404 error and allow your customers to complete their payments.