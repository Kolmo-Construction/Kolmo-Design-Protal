DATABASE SCHEMA
This schema covers:

Projects and versions

Tasks with dependencies and lineage

Task chunks for vector retrieval (with embeddings)

Users and feedback

Corpus evolution tracking

ðŸ”© projects
ts
Copy
Edit
projects {
  id: uuid PRIMARY KEY,
  name: varchar,
  description: text,
  project_type: varchar, // e.g., 'bathroom remodel'
  square_footage: int,
  zip_code: varchar,
  status: varchar DEFAULT 'draft', // 'draft', 'finalized', 'archived'
  created_by: uuid REFERENCES users(id),
  created_at: timestamp DEFAULT now(),
  updated_at: timestamp
}
ðŸ“˜ project_versions
Allows immutable versioning of task bundles per project (very useful for change orders or timeline drift).

ts
Copy
Edit
project_versions {
  id: uuid PRIMARY KEY,
  project_id: uuid REFERENCES projects(id),
  version_number: int,
  notes: text,
  created_at: timestamp DEFAULT now()
}
ðŸ§± tasks
ts
Copy
Edit
tasks {
  id: uuid PRIMARY KEY,
  project_version_id: uuid REFERENCES project_versions(id),
  task_name: varchar,
  trade: varchar, // e.g., 'plumber', 'tile setter'
  phase: varchar, // e.g., 'Rough-In', 'Finish'
  description: text,
  duration_days: float,
  required_materials: text[],
  required_inspections: text[],
  notes: text,
  is_generated: boolean DEFAULT true,
  created_at: timestamp DEFAULT now()
}
ðŸ”— task_dependencies
Many-to-many between tasks in a versioned project.

ts
Copy
Edit
task_dependencies {
  id: uuid PRIMARY KEY,
  task_id: uuid REFERENCES tasks(id),
  depends_on_task_id: uuid REFERENCES tasks(id)
}
ðŸ“š task_chunks (RAG corpus)
This stores your seed/synthetic corpus of reusable tasks for retrieval.

ts
Copy
Edit
task_chunks {
  id: uuid PRIMARY KEY,
  task_text: text,  // canonical description
  trade: varchar,
  phase: varchar,
  project_type: varchar,
  embedding: vector(1536),
  metadata: jsonb,
  created_at: timestamp DEFAULT now()
}
Optionally normalize this with tags/lookup tables (trades, phases, etc.)

ðŸ§  generation_prompts
Stores the input spec and prompt used for generating a versioned task bundle.

ts
Copy
Edit
generation_prompts {
  id: uuid PRIMARY KEY,
  project_version_id: uuid REFERENCES project_versions(id),
  input_text: text,  // what the user typed
  raw_prompt: text,
  used_embedding_ids: uuid[],
  llm_output: jsonb,
  model_used: varchar,
  created_at: timestamp DEFAULT now()
}
ðŸ‘¤ users
ts
Copy
Edit
users {
  id: uuid PRIMARY KEY,
  email: varchar UNIQUE,
  name: varchar,
  role: varchar, // 'admin', 'pm', 'editor'
  created_at: timestamp DEFAULT now()
}
âœ… task_feedback
For refining generations.

ts
Copy
Edit
task_feedback {
  id: uuid PRIMARY KEY,
  task_id: uuid REFERENCES tasks(id),
  user_id: uuid REFERENCES users(id),
  feedback_type: varchar, // 'edit', 'approve', 'reject'
  old_value: jsonb,
  new_value: jsonb,
  comment: text,
  created_at: timestamp DEFAULT now()
}
